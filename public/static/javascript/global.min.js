let movileIcon=document.querySelector(".header__icon--menu");headerContainer=document.querySelector(".header__container"),headerContainerMovile=document.querySelector(".header__container--movile"),movileMenu=document.querySelector(".header__nav"),searchForm=document.querySelector(".header__form"),searchInput=document.querySelector(".header__input"),searchContainer=document.querySelector(".header__container--search"),menuMobileIcon=document.querySelector(".control__icon--menu"),menuList=document.querySelector(".control__list"),searchXhr="";let indexCardButton=document.querySelectorAll(".card__button--index"),indexGallery=document.querySelector(".index__gallery"),indexWrapper=document.querySelector(".gallery__wrapper"),indexGalleryImg=document.querySelectorAll(".gallery__asset--index"),wrapperPos=0,indexGalleryArrows=document.querySelectorAll(".index__arrow"),indexPaginatorGallery=document.querySelectorAll('[class*="gallery__ball"]'),faqHeader=document.querySelectorAll(".faq__header"),min=document.querySelectorAll('[class*="gallery__min"]'),gallery=document.querySelector(".gallery__asset"),arrows=document.querySelectorAll(".gallery__arrow"),objectIndex=0,productWishlist=document.querySelector(".info__button--wish"),productWishlistIcon=document.querySelector(".info_icon--wish"),productCartButton=document.querySelector(".info__button--buy"),reviewsButton=document.querySelector(".reviews__button"),reviewsForm=document.querySelector(".reviews__form--container"),cartNum=document.querySelector(".header__cartCant"),slider=document.querySelector(".slider"),wrapper=document.querySelector(".gallery__wrapper"),wrapperImg=document.querySelectorAll(".gallery__asset--mobile"),sliderPaginator=document.querySelectorAll('[class*="gallery__ball"]'),controlIconCollapse=document.querySelectorAll(".control__icon--collapse"),deleteCardButtons=document.querySelectorAll(".pay__icon--delete"),deleteBillingButtons=document.querySelectorAll(".billing__icon--delete"),container=document.querySelector(".control__container--billing"),closeForm=document.querySelectorAll(".card__icon--closeForm"),addCardButton=document.querySelector(".control__add--card"),formCard=document.querySelector(".control__form--card"),addBillingButton=document.querySelector(".control__add--billing"),formBilling=document.querySelector(".control__form--billing"),button=document.querySelectorAll(".order__icon"),ordersContainer=document.querySelector(".control__order"),orderXhr="",deleteButton=document.querySelectorAll(".wish__icon--x"),deleteButtonMin=document.querySelectorAll(".wish__icon--delete"),addCartButton=document.querySelectorAll(".wish__icon--cart"),wishControlContainer=document.querySelector(".control__content--wishlist"),wishContainer=document.querySelector(".control__wish"),wishXhr="",lastPage=document.querySelector(".paginator__last"),actual=document.querySelector(".paginator__actual"),pageBtnWish=document.querySelectorAll(".paginator__button--wish"),pageBtnOrders=document.querySelectorAll(".paginator__button--orders"),pageBtnReviews=document.querySelectorAll(".paginator__button--reviews"),pageBtnReviewsUser=document.querySelectorAll(".paginator__button--reviewsUser"),page=1,cartDeleteButton=document.querySelectorAll(".card__icon--delete"),cartPrice=document.querySelector(".cart__text--total"),cartTotal=document.querySelector(".cart__text"),cartTotalHeader=document.querySelector(".header__cartCant"),dashButton=document.querySelectorAll(".bi-dash-square"),addButton=document.querySelectorAll(".bi-plus-square"),cardsContainer=document.querySelector(".cart__products"),reviewsSection=document.querySelector(".reviews"),reviewsContainer=document.querySelector(".reviews__container"),keysButton=document.querySelectorAll('button[class="keys__button"]'),reviewsUserContainer=document.querySelector(".control__reviews");try{dataListeners()}catch(error){}try{orderListeners()}catch(error){}try{wishlistListeners()}catch(error){}function setLoading(div,elementClass="reviews__loading"){let loading=document.createElement("div");loading.classList.add(elementClass),div.innerHTML="",div.appendChild(loading)}function collapse(collapseClass,element,icon){element.classList.contains(collapseClass)?(element.style.maxHeight=element.scrollHeight+"px",setTimeout(()=>{element.classList.toggle(collapseClass),element.removeAttribute("style")},400)):(element.style.maxHeight=element.clientHeight+"px",setTimeout(()=>{element.classList.toggle(collapseClass),element.removeAttribute("style")},10)),icon.classList.toggle("control__icon--rotate")}function changeButtons(page,btnLeft,btnRight,lastPage){1==page?btnLeft.classList.replace("paginator__button","paginator__button--disabled"):btnLeft.classList.replace("paginator__button--disabled","paginator__button"),page==lastPage?btnRight.classList.replace("paginator__button","paginator__button--disabled"):btnRight.classList.replace("paginator__button--disabled","paginator__button")}function setGameCart(gameData){let xhr=new XMLHttpRequest,data=new FormData;data.append("game",gameData[0]),data.append("platform",gameData[1]);try{data.append("cartCount",cartNum.textContent)}catch(error){data.append("cartCount",0)}xhr.open("POST","/ajax/addProductCart",!0),xhr.send(data),xhr.onreadystatechange=()=>{4==xhr.readyState&&302==xhr.status?window.location.href="/users/login":4==xhr.readyState&&200==xhr.status&&(cartNum.textContent=xhr.responseText)}}function wrapGallery(imgs,wrapper,initialPos,paginator=null){wrapper.addEventListener("touchmove",e=>{e.touches[0].pageX>initialPos?direction=-1:direction=1,moveGalleryWrapper(wrapper,imgs,direction,paginator)},{once:!0}),wrapper.addEventListener("mousemove",e=>{e.pageX>initialPos?direction=-1:direction=1,moveGalleryWrapper(wrapper,imgs,direction,paginator)},{once:!0})}function moveGalleryWrapper(wrapper,imgs,direction,paginator=null){let imgWidth=imgs[0].offsetWidth,max=imgWidth*imgs.length;wrapperPos-=imgWidth*direction,Math.abs(wrapperPos)>=max&&(wrapperPos=0),wrapperPos>0&&(wrapperPos=-max+imgWidth),wrapper.style.transform=`translateX(${wrapperPos}px)`;let index=Math.abs(wrapperPos/imgWidth);null!=paginator&&(paginator.forEach(ball=>{ball.classList.replace("gallery__ball--selected","gallery__ball")}),paginator[index].classList.replace("gallery__ball","gallery__ball--selected"))}function changeGalleryImg(min){let minSelected=document.querySelector(".gallery__min--selected"),src=min.querySelector(".gallery__asset").getAttribute("src");src=src.replace("-min",""),minSelected.classList.replace("gallery__min--selected","gallery__min"),min.classList.replace("gallery__min","gallery__min--selected"),gallery.setAttribute("src",src)}function slide(direction){let minSelected=document.querySelector(".gallery__min--selected"),index=Array.prototype.indexOf.call(min,minSelected);"right"==direction?(index+=1,objectIndex+=1,index>3&&objectIndex<images.length?(changeMinImg(index-3,images.length),index=3):objectIndex>=images.length&&(objectIndex=0,index=0,changeMinImg(0,4))):(index-=1,objectIndex-=1,index<0&&(objectIndex<0?(changeMinImg(images.length-4,images.length),index=3,objectIndex=images.length-1):(changeMinImg(0,4),index=0,objectIndex=0))),changeGalleryImg(min[index])}function changeMinImg(init,max){let minindex=0;for(let i=init;i<max;i++)img=min[minindex].querySelector(".gallery__asset"),img.setAttribute("src",`/static/img/games/${images[i]}-min.webp`),minindex+=1}function setWishlist(gameData){let xhr=new XMLHttpRequest,data=new FormData;data.append("game",gameData[0]),data.append("platform",gameData[1]),xhr.open("POST","/ajax/wishlist",!0),xhr.send(data),productWishlistIcon.classList.contains("bi-heart-fill")?productWishlistIcon.classList.replace("bi-heart-fill","bi-heart"):productWishlistIcon.classList.replace("bi-heart","bi-heart-fill"),xhr.onreadystatechange=()=>{4==xhr.readyState&&302==xhr.status&&(window.location.href="/users/login")}}function deleteWishGame(card){let xhr=new XMLHttpRequest,data=new FormData;data.append("game",card.getAttribute("game")),data.append("platform",card.getAttribute("platform")),data.append("page",page),xhr.open("POST","/ajax/delete_wishlist",!0),xhr.send(data),xhr.onreadystatechange=()=>{4==xhr.readyState&&302==xhr.status?window.location.href="/users/login":4==xhr.readyState&&200==xhr.status&&(wishControlContainer.innerHTML=xhr.responseText,reloadWishlist())}}function changePage(direction){"left"==direction?page-=1:page+=1,""!=orderXhr?orderXhr.abort():orderXhr=new XMLHttpRequest,orderXhr.open("GET","/ajax/get_orders?page="+page,!0),orderXhr.send(),actual.innerHTML=page,changeButtons(page,pageBtnOrders[0],pageBtnOrders[1],lastPage.textContent),setLoading(ordersContainer),orderXhr.onreadystatechange=()=>{4==orderXhr.readyState&&200==orderXhr.status&&(ordersContainer.innerHTML=orderXhr.responseText,reloadOrders())}}function deleteUserInfo(card,type){let id=card.getAttribute("identifier"),cardsContainer=card.parentNode,xhr=new XMLHttpRequest;"card"==type?xhr.open("PUT","/ajax/deleteCard?id="+id,!0):xhr.open("PUT","/ajax/deleteBilling?id="+id,!0),xhr.send(),xhr.onreadystatechange=()=>{4==xhr.readyState&&200==xhr.status&&cardsContainer.removeChild(card)}}function getGames(direction){"left"==direction?page-=1:page+=1,""!=wishXhr?wishXhr.abort():wishXhr=new XMLHttpRequest,wishXhr.open("GET","/ajax/wishlist_games?page="+page,!0),wishXhr.send(),setLoading(wishContainer),changeButtons(page,pageBtnWish[0],pageBtnWish[1],lastPage.textContent),actual.innerHTML=page,wishXhr.onreadystatechange=()=>{4==wishXhr.readyState&&200==wishXhr.status&&(wishControlContainer.innerHTML=wishXhr.responseText,reloadWishlist(),changeButtons(page,pageBtnWish[0],pageBtnWish[1],lastPage.textContent))}}function removeGameCart(card){let xhr=new XMLHttpRequest,data=new FormData;data.append("game",card.getAttribute("targetgame")),data.append("platform",card.getAttribute("targetplatform")),xhr.open("POST","/ajax/removeCartProduct",!0),xhr.send(data),xhr.onreadystatechange=()=>{if(4==xhr.readyState&&302==xhr.status)window.location.href="/users/login";else if(4==xhr.readyState&&200==xhr.status){let response=JSON.parse(xhr.responseText);cartPrice.textContent=parseFloat(response.totalPrice).toFixed(2)+" €",cartTotalHeader.textContent=response.cartTotal,cartTotal.textContent=response.cartTotal,cardsContainer.removeChild(card)}}}function changeCantCart(changeValue,card){let xhr=new XMLHttpRequest,data=new FormData;data.append("game",card.getAttribute("targetgame")),data.append("platform",card.getAttribute("targetplatform")),data.append("changeValue",changeValue),xhr.open("POST","/ajax/changeCartCant",!0),xhr.send(data),xhr.onreadystatechange=()=>{if(4==xhr.readyState&&200==xhr.status){let response=JSON.parse(xhr.responseText),cartCant=card.querySelector(".cart__cant"),newCant=parseInt(cartCant.textContent)+parseInt(changeValue);cartPrice.textContent=parseFloat(response.totalPrice).toFixed(2)+"€",cartTotalHeader.textContent=response.cartTotal,cartTotal.textContent=response.cartTotal,newCant<=0?cardsContainer.removeChild(card):cartCant.textContent=newCant}}}function getReviews(direction,container,buttons,id=null,platform=null){"left"==direction?page-=1:page+=1,xhr=new XMLHttpRequest,xhr.open("GET",null==id?"/ajax/reviews_user?page="+page:"/ajax/reviews?id="+id+"&platform="+platform+"&page="+page,!0),xhr.send(),setLoading(container),changeButtons(page,buttons[0],buttons[1],lastPage.textContent),actual.innerHTML=page,xhr.onreadystatechange=()=>{4==xhr.readyState&&200==xhr.status&&(container.innerHTML=xhr.responseText,actual.innerHTML=page,changeButtons(page,buttons[0],buttons[1],lastPage.textContent))},container.scrollIntoView({behavior:"smooth"})}function dataListeners(){controlIconCollapse.forEach(collapseIcon=>{collapseIcon.addEventListener("click",()=>{let container,target;collapse("collapsed--unset",collapseIcon.parentNode.parentNode.querySelector(".control__container--collapse"),collapseIcon)})}),deleteCardButtons.forEach(deleteButton=>{deleteButton.addEventListener("click",()=>{deleteUserInfo(deleteButton.parentNode,"card")})}),deleteBillingButtons.forEach(deleteButton=>{deleteButton.addEventListener("click",()=>{deleteUserInfo(deleteButton.parentNode,"billing")})}),addCardButton.addEventListener("click",()=>{let container;formCard.parentNode.classList.toggle("control__container--none")}),addBillingButton.addEventListener("click",()=>{let container;formBilling.parentNode.classList.toggle("control__container--none")}),closeForm.forEach(button=>{button.addEventListener("click",()=>{let container;button.parentNode.parentNode.classList.toggle("control__container--none")})})}function orderListeners(){button.forEach(arrow=>{arrow.addEventListener("click",()=>{let container,bottom;collapse("collapsed",arrow.parentNode.parentNode.querySelector(".order__bottom"),arrow)})}),pageBtnOrders.forEach(button=>{button.addEventListener("click",()=>{let direction=button.getAttribute("direction");button.classList.contains("paginator__button--disabled")||changePage(direction)})}),keysButton.forEach(button=>{button.addEventListener("click",()=>{let container,key=button.parentNode.querySelector(".keys__key").textContent;navigator.clipboard.writeText(key),button.textContent="Copiado",setTimeout(()=>{button.textContent="Copiar"},2e3)})})}function wishlistListeners(){deleteButton.forEach(button=>{button.addEventListener("click",()=>{deleteWishGame(button.parentNode)})}),deleteButtonMin.forEach(button=>{button.addEventListener("click",()=>{deleteWishGame(button.parentNode.parentNode)})}),addCartButton.forEach(button=>{button.addEventListener("click",()=>{let container=button.parentNode.parentNode;setGameCart([container.getAttribute("game"),container.getAttribute("platform")])})}),"undefined"==pageBtnWish&&null==pageBtnWish||pageBtnWish.forEach(btn=>{btn.addEventListener("click",()=>{let direction=btn.getAttribute("direction");btn.classList.contains("paginator__button--disabled")||getGames(direction)})})}function reloadOrders(){button=document.querySelectorAll(".order__icon"),orderListeners()}function reloadWishlist(){deleteButton=document.querySelectorAll(".wish__icon--x"),deleteButtonMin=document.querySelectorAll(".wish__icon--delete"),addCartButton=document.querySelectorAll(".wish__icon--cart"),wishContainer=document.querySelector(".control__wish");try{pageBtnWish=document.querySelectorAll('[class*="paginator__button"]'),wishContainer=document.querySelector(".control__wish"),lastPage=document.querySelector(".paginator__last"),actual=document.querySelector(".paginator__actual")}catch(error){}wishlistListeners()}"undefined"!=reviewsButton&&null!=reviewsButton&&reviewsButton.addEventListener("click",()=>{reviewsForm.classList.toggle("displayNone"),reviewsContainer.hasAttribute("style")?reviewsContainer.removeAttribute("style"):reviewsContainer.style.minHeight="550px"}),"undefined"!=pageBtnReviews&&null!=pageBtnReviews&&pageBtnReviews.forEach(btn=>{btn.addEventListener("click",()=>{let game=reviewsSection.getAttribute("game"),platform=reviewsSection.getAttribute("platform"),direction=btn.getAttribute("direction");btn.classList.contains("paginator__button--disabled")||getReviews(direction,reviewsContainer,pageBtnReviews,game,platform)})}),"undefined"!=pageBtnReviewsUser&&null!=pageBtnReviewsUser&&pageBtnReviewsUser.forEach(btn=>{btn.addEventListener("click",()=>{let direction=btn.getAttribute("direction");btn.classList.contains("paginator__button--disabled")||getReviews(direction,reviewsUserContainer,pageBtnReviewsUser)})}),"undefined"!=indexWrapper&&null!=indexWrapper&&(indexWrapper.addEventListener("touchstart",e=>{wrapGallery(indexGalleryImg,indexWrapper,e.touches[0].pageX,indexPaginatorGallery)}),indexWrapper.addEventListener("dragstart",e=>{wrapGallery(indexGalleryImg,indexWrapper,e.pageX,indexPaginatorGallery)})),indexGalleryArrows.forEach(arrow=>{arrow.addEventListener("click",()=>{let direction="left"==arrow.getAttribute("direction")?-1:1;moveGalleryWrapper(indexWrapper,indexGalleryImg,direction,indexPaginatorGallery)})}),indexCardButton.forEach(button=>{button.addEventListener("click",()=>{let id,platform;setGameCart([button.getAttribute("game"),button.getAttribute("platform")])})}),min.forEach(element=>{element.addEventListener("click",()=>{if(!element.classList.contains("gallery__min--selected")){changeGalleryImg(element);let img=element.querySelector(".gallery__asset").getAttribute("src");img=img.replace("/static/img/games/",""),img=img.replace("-min.webp",""),objectIndex=Array.prototype.indexOf.call(images,img)}})}),arrows.forEach(arrow=>{arrow.addEventListener("click",()=>{slide(arrow.getAttribute("slide"))})}),"undefined"!=productCartButton&&null!=productCartButton&&productCartButton.addEventListener("click",()=>{setGameCart(product)}),"undefined"!=wrapper&&null!=wrapper&&(wrapper.addEventListener("touchstart",e=>{wrapGallery(wrapperImg,wrapper,e.touches[0].pageX,sliderPaginator)}),wrapper.addEventListener("dragstart",e=>{wrapGallery(wrapperImg,wrapper,e.pageX,sliderPaginator)})),"undefined"!=productWishlist&&null!=productWishlist&&productWishlist.addEventListener("click",()=>{setWishlist(product)}),"undefined"!=cartDeleteButton&&null!=cartDeleteButton&&cartDeleteButton.forEach(button=>{button.addEventListener("click",()=>{let container,card;console.log(button),removeGameCart(button.parentNode.parentNode)})}),"undefined"!=dashButton&&null!=dashButton&&dashButton.forEach(button=>{button.addEventListener("click",()=>{let container,card;changeCantCart(-1,button.parentNode.parentNode.parentNode)})}),"undefined"!=addButton&&null!=addButton&&addButton.forEach(button=>{button.addEventListener("click",()=>{let container,card;changeCantCart(1,button.parentNode.parentNode.parentNode)})}),"undefined"!=faqHeader&&null!=faqHeader&&faqHeader.forEach(header=>{header.addEventListener("click",()=>{let parent=header.parentNode,text,icon;collapse("collapsed",parent.querySelector(".faq__answer"),parent.querySelector(".faq__icon"))})}),searchInput.addEventListener("input",()=>{""!=searchXhr&&searchXhr.abort(),searchXhr=new XMLHttpRequest;let input=searchInput.value;searchXhr.open("GET",`/ajax/searchBarResult?string=${input}`),searchXhr.send();let searchLoading=setTimeout(()=>{setLoading(searchContainer)},200);searchXhr.onreadystatechange=()=>{4==searchXhr.readyState&&200==searchXhr.status?(searchContainer.innerHTML=searchXhr.responseText,clearTimeout(searchLoading),searchXhr=""):4==searchXhr.readyState&&404==searchXhr.status&&(searchContainer.innerHTML="",clearTimeout(searchLoading))}}),document.addEventListener("click",e=>{e.target==searchInput&&e.target==searchContainer||(searchContainer.innerHTML="","undefined"!=typeof variable&&null!=variable&&clearTimeout(searchLoading),""!=searchXhr&&searchXhr.abort())}),movileIcon.addEventListener("click",()=>{movileMenu.classList.toggle("header__nav--visible"),setTimeout(()=>{movileMenu.classList.toggle("header__nav--hidde")},300)}),"undefined"!=menuMobileIcon&&null!=menuMobileIcon&&menuMobileIcon.addEventListener("click",()=>{collapse("collapsed--unset",menuList,menuMobileIcon)});